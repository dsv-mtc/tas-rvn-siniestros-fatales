<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mapa interactivo ‚Äì Siniestros fatales RVN</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.polylinemeasure/Leaflet.PolylineMeasure.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.css">

<style>
html, body { height:100%; margin:0; }
#map { height:100vh; width:100%; }

/* ================= LEYENDA ================= */
.legend{
  background:rgba(255,255,255,0.95);
  padding:0;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,0.15);
  font:12px/1.35 system-ui, Arial;
  width:260px;
  overflow:hidden;
}

.legend-header{
  padding:10px 12px;
  font-weight:700;
  background:#f4f4f4;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.legend-body{
  padding:10px 12px;
  max-height:45vh;
  overflow:auto;
}

.legend.collapsed .legend-body{
  display:none;
}

.legend-title{
  font-weight:700;
  margin:10px 0 6px;
  border-bottom:1px solid #ddd;
}

.legend-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin:4px 0;
}

.swatch{
  width:14px;
  height:14px;
  border-radius:3px;
  border:1px solid rgba(0,0,0,0.25);
}
.swatch.line{ height:4px; border:none; }
.swatch.dashed{
  background:none;
  border:2px dashed #333;
  height:10px;
}

/* ======= AJUSTES M√ìVIL ======= */
@media (max-width: 768px) {

  .legend{
    width: 90vw;
    max-width: 320px;
    font-size: 11px;
  }

  .legend-body{
    max-height: 40vh;
  }

  .leaflet-control-layers{
    font-size: 12px;
  }
}
</style>
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.polylinemeasure/Leaflet.PolylineMeasure.js"></script>
<script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>

<script>
//////////////////////////////////////////////////
// MAPA BASE
//////////////////////////////////////////////////
var map = L.map('map').setView([-9.2, -75], 6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

//////////////////////////////////////////////////
// CONTROLES
//////////////////////////////////////////////////
L.control.polylineMeasure({
  position:'topleft',
  unit:'metres',
  tooltipTextFinish:'Doble clic para terminar'
}).addTo(map);

L.control.scale({
  position:'bottomright',
  metric:true,
  imperial:false
}).addTo(map);

new L.Control.MiniMap(
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
  {toggleDisplay:true, minimized:false}
).addTo(map);

//////////////////////////////////////////////////
// UBICACI√ìN ACTUAL (AGREGADO)
//////////////////////////////////////////////////
var userMarker = null;
var userCircle = null;

var locateControl = L.control({ position:'topleft' });

locateControl.onAdd = function(){
  var div = L.DomUtil.create('div','leaflet-bar leaflet-control');
  div.innerHTML = 'üìç';
  div.title = 'Ir a mi ubicaci√≥n';
  div.style.backgroundColor = '#fff';
  div.style.width = '34px';
  div.style.height = '34px';
  div.style.lineHeight = '34px';
  div.style.textAlign = 'center';
  div.style.cursor = 'pointer';
  div.style.fontSize = '18px';

  L.DomEvent.on(div,'click',function(e){
    L.DomEvent.stop(e);
    map.locate({setView:true, maxZoom:16});
  });

  return div;
};

locateControl.addTo(map);

map.on('locationfound',function(e){
  if(userMarker) map.removeLayer(userMarker);
  if(userCircle) map.removeLayer(userCircle);

  userMarker = L.circleMarker(e.latlng,{
    radius:6,
    fillColor:'#1976d2',
    color:'#fff',
    weight:2,
    fillOpacity:0.9
  }).addTo(map);

  userCircle = L.circle(e.latlng,{
    radius:e.accuracy,
    color:'#1976d2',
    weight:1,
    opacity:0.4,
    fillOpacity:0.1
  }).addTo(map);

  userMarker.bindTooltip(
    'Tu ubicaci√≥n<br>Precisi√≥n: ¬±'+Math.round(e.accuracy)+' m',
    {sticky:true}
  );
});

map.on('locationerror',function(){
  alert('No se pudo obtener la ubicaci√≥n');
});
</script>
</body>
</html>
